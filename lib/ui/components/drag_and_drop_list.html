<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DragAndDropList component example</title>
    <style>
        body {
            padding: 0.5rem;
        }

        button {
            margin: 0.5rem 1rem;
        }
    </style>
</head>

<body class="">
</body>

<script type="module">
    import { DragAndDropList } from '/lib/ui/components/DragAndDropList.js'
    import van, { injectTagsIntoWindow, renderAfterLoad } from '/lib/ui/van-wrapper.js'

    injectTagsIntoWindow()
    renderAfterLoad(app)

    const items = [...Array(5).keys()].map(i => 'item ' + i)

    function app() {
        const newItemInput = input({ style: 'margin-bottom: 1rem' })

        let itemsData = items

        const itemsList = new DragAndDropList({
            items: itemsData.map(itemText => Item({ id: itemText }, itemText)),
            onSelect(index) {
                itemsList.getElement(index).style.backgroundColor = 'gray'
            },
            onDeselect(index) {
                itemsList.getElement(index).style.background = 'none'
            },
            onDrop: (selectedIndexes, droppedIndex) => {
                itemsData = DragAndDropList.applyDrop(itemsData, selectedIndexes, droppedIndex)
            },
        })

        return main(
            newItemInput,
            button({ onclick: () => addItem() }, 'add'),
            itemsList.element,
        )

        function Item({ id }, text) {
            return [
                span(text),
                button({ onclick: () => removeItem(id) }, 'remove'),
            ]
        }

        function addItem() {
            const itemText = newItemInput.value
            if (itemText.length === 0) return
            itemsList.addItem(
                Item({ id: itemText }, itemText)
            )
            itemsData.push(itemText)
            newItemInput.value = ''
        }

        function removeItem(id) {
            itemsList.removeItem(itemsData.indexOf(id))
            itemsData = itemsData.filter(it => it !== id)
        }
    }
</script>
<!-- <script type="module" src="/lib/ui/components/DragAndDropList.user.test.js"></script> -->

</html>