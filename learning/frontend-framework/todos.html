<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>todos</title>
    <link rel="stylesheet" href="/style/dark.css" />
    <script type="module" src="./fw.js"></script>
</head>

<body style="margin: auto; max-width: 1280px">
</body>

<template app>
    <script>
        console.debug('script', { isESModule: typeof import.meta !== "undefined" }) // DEV

        let newTask = $state('')
        let filter = $state('all')
        let tasks = $state([
            { title: 'first task', done: true }, { title: 'second task', done: false },
        ])

        let tasksByFilter = $derive(() => ({
            all: tasks.val,
            active: tasks.val.filter(t => !t.done),
            completed: tasks.val.filter(t => t.done),
        }))
        let filtered = $derive(() => tasksByFilter[filter.val])

        let createTask = (title) => {
            tasks.val = [...tasks.val, { title, done: false, id: tasks.val.length }]
        }
        let toggleTask = (id) => {
            tasks.val = tasks.val.map(t => t.id === id ? { ...t, done: !t.done } : t)
        }
        let deleteTask = (id) => {
            tasks.val = tasks.val.filter(t => t.id !== id)
        }

        // setInterval(() => createTask(''), 2000)
        // $derive(() => console.log('tasks', tasks.val.length))
        // $derive(() => console.log({ filter: filter.val, filtered: filtered.val }))

        // let task = $derive(() => tasks.val[0]) // FIX undefined
        // $derive(() => console.log('parent task', task.val))
    </script>

    <!-- <header>
        <h1>Task Tracker</h1>
    </header> -->

    <div style="display: flex">
        <main style="flex: 1">
            <!-- <input type="text" :model="newTask" placeholder="New task">
            <button @click="createTask">Add task</button>

            <div>
                <button @click="filter.val = 'all'">All</button>
                <button @click="filter.val = 'active'">Active</button>
                <button @click="filter.val = 'completed'">Completed</button>
            </div> -->

            <ul>
                <!-- <li :if="filtered.val.length" :for="task in filtered.val"> -->
                <li :for="task in filtered.val">
                    <input type="text" :value="task.title">
                    <!-- <task-item :task @toggle="toggleTask" @delete="deleteTask"></task-item> -->
                </li>
                <!-- <li :else>No tasks</li> -->
            </ul>
        </main>

        <!-- <aside>
            <div>
                <p>Total tasks: {tasksByFilter.all.length}</p>
                <p>Active tasks: {tasksByFilter.active.length}</p>
                <p>Completed tasks: {tasksByFilter.completed.length}</p>
            </div>
        </aside> -->
    </div>
</template>

<template component="TaskItem">
    <script>
        console.debug('script', { isESModule: typeof import.meta !== "undefined" }) // DEV

        let { task } = $props
        // $derive(() => console.log('component task', { task: $props.task }))
        $derive(() => console.log('component task.title', { task: $props.task?.title }))
        // $derive(() => console.log('component task done', { task: $props.task.done }))
    </script>

    <input type="checkbox" :checked="task.done" @input="$emit('toggle', task.id)">
    <span>{task.title}</span>
    <delete-button @click="$emit('delete', task.id)"></delete-button>
</template>

<template component="DeleteButton">
    <button @click="confirm('Are you sure?') && $emit('click')">x</button>

    <style>
        button {
            color: red;
        }
    </style>
</template>

</html>